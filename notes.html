<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–ö–æ–Ω—Å–ø–µ–∫—Ç—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  
  <link rel="stylesheet" href="style.css"> 
</head>
<body>

<div class="container"> 

  <header class="note" style="margin-top:20px; margin-bottom: 20px;">
    <h1>üìö –ö–æ–Ω—Å–ø–µ–∫—Ç—ã</h1>
  </header>

  <section class="note" style="margin-bottom: 20px;">
    <input
      id="search"
      placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º..."
      autocomplete="off"
      class="search-input"
    >
    <a href="index.html" class="back-link">
      ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>
  </section>

  <div id="notes"></div>

</div>

<footer>
  <div class="container">
    ¬© <span id="year"></span> –û–≤—Å–∏–µ–Ω–∫–æ –ê–ª–µ–∫—Å–µ–π
  </div>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

let allNotes = [];

// === –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• (—Å –Ω–∞–¥–µ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø—É—Ç–∏ –∏ –æ—à–∏–±–æ–∫) ===

// –ò—Å–ø–æ–ª—å–∑—É–µ–º /notes.json –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç –∫–æ—Ä–Ω—è —Å–∞–π—Ç–∞, —á—Ç–æ –Ω–∞–¥–µ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Netlify
fetch('/notes.json') 
  .then(r => {
    if (!r.ok) {
        // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ 200 (–Ω–∞–ø—Ä–∏–º–µ—Ä, 404), –±—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É
        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å notes.json. –°—Ç–∞—Ç—É—Å: ' + r.status);
    }
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º .text(), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å SyntaxError –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–∫–∏
    return r.text(); 
  })
  .then(text => {
    try {
        // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–∞–∫ JSON
        const data = JSON.parse(text); 
        allNotes = data;
        renderNotes(data);
    } catch (e) {
        // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è (–≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON –∏–ª–∏ BOM-–º–∞—Ä–∫–µ—Ä)
        console.error("–û–®–ò–ë–ö–ê –ü–ê–†–°–ò–ù–ì–ê JSON:", e);
        throw new Error('–§–∞–π–ª notes.json –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º JSON. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.');
    }
  })
  .catch(err => {
    // –í —ç—Ç–æ–º –±–ª–æ–∫–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –æ—à–∏–±–∫–∏ (404, –Ω–µ–≤–µ—Ä–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –ø—Ä–æ–±–ª–µ–º—ã —Å–µ—Ç–∏)
    console.error("–û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò –ö–û–ù–°–ü–ï–ö–¢–û–í:", err);
    document.getElementById('notes').innerHTML =
      '<p class="note" style="color: #e3342f; text-align: center; border: 1px solid #f9d8d8;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤: –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ö–æ–Ω—Å–æ–ª—å (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.</p>';
  });

// === –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ö–û–ù–°–ü–ï–ö–¢–û–í (–°–µ—Ç–∫–∞) ===
function renderNotes(data) {
  const container = document.getElementById('notes');
  container.innerHTML = '';

  let empty = true;

  for (const section in data) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç—É –∏ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
    if (!data.hasOwnProperty(section)  !data[section]  !data[section].length) continue;

    empty = false;

    const sectionEl = document.createElement('div');
    sectionEl.className = 'section'; 

    sectionEl.innerHTML = <h2>${section}</h2>;
    
    // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–µ—Ç–∫–∏ –¥–ª—è –ø–ª–∏—Ç–æ–∫
    const gridContainer = document.createElement('div');
    gridContainer.className = 'notes-grid';
    
    data[section].forEach(note => {
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∑–∞–ø–∏—Å—å –Ω–µ –ø—É—Å—Ç–∞—è
      if (!note  !note.title  !note.file) return; 
      
      const noteWrapper = document.createElement('div');
      noteWrapper.className = 'note-item-wrapper note';

      noteWrapper.innerHTML = `
        <a href="${note.file}">
          üìÑ ${note.title}
        </a>
        <a href="${note.file}" download class="download-link">
          ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å
        </a>
      `;

      gridContainer.appendChild(noteWrapper);
    });
    
    sectionEl.appendChild(gridContainer); 

    container.appendChild(sectionEl);
  }

  if (empty) {
    container.innerHTML = '<p class="note" style="text-align: center;">–ö–æ–Ω—Å–ø–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É.</p>';
  }
}

// === –û–ë–†–ê–ë–û–¢–ß–ò–ö –ü–û–ò–°–ö–ê ===
document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  const filtered = {};

  for (const section in allNotes) {
    if (!allNotes.hasOwnProperty(section)) continue;

    filtered[section] = allNotes[section].filter(note =>
      note.title.toLowerCase().includes(q)
    );
  }

  renderNotes(filtered);
});
</script>
</body>
</html>
