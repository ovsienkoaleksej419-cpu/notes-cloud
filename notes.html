<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Notes</title>
  <link rel="stylesheet" href="style.css"> 
</head>
<body>

<div class="container"> 

  <header class="note" style="margin-top:20px; margin-bottom: 20px;">
    <h1>üìö –ö–æ–Ω—Å–ø–µ–∫—Ç—ã</h1>
  </header>

  <section class="note" style="margin-bottom: 20px;">
    <input
      id="search"
      placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º..."
      autocomplete="off"
      class="search-input"
    >
    
    <a href="index.html" class="back-link">
      ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>
  </section>

  <div id="notes"></div>

</div>

<footer>
  <div class="container">
    ¬© <span id="year"></span> –û–≤—Å–∏–µ–Ω–∫–æ –ê–ª–µ–∫—Å–µ–π
  </div>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

let allNotes = [];

fetch('notes.json')
  .then(r => {
    if (!r.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å notes.json');
    return r.json();
  })
  .then(data => {
    allNotes = data;
    renderNotes(data);
  })
  .catch(err => {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å 'note' –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
    document.getElementById('notes').innerHTML =
      '<p class="note" style="color: #e3342f; text-align: center; border: 1px solid #f9d8d8;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª notes.json.</p>';
    console.error(err);
  });

function renderNotes(data) {
  const container = document.getElementById('notes');
  container.innerHTML = '';

  let empty = true;

  for (const section in data) {
    if (!data[section] || !data[section].length) continue;

    empty = false;

    const sectionEl = document.createElement('div');
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Å .section –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
    sectionEl.className = 'section'; 

    sectionEl.innerHTML = <h2>${section}</h2>;

    data[section].forEach(note => {
      const noteWrapper = document.createElement('div');
      // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Å—ã–ª–∫–∏ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      noteWrapper.className = 'note-item-wrapper'; 

      // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Å—ã–ª–∫–æ–π –∏ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
      noteWrapper.innerHTML = `
        <a href="${note.file}">
          üìÑ ${note.title}
        </a>
        <a href="${note.file}" download class="download-link">
          ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å
        </a>
      `;

      sectionEl.appendChild(noteWrapper);
    });

    container.appendChild(sectionEl);
  }

  if (empty) {
    container.innerHTML = '<p class="note" style="text-align: center;">–ö–æ–Ω—Å–ø–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É.</p>';
  }
}

document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  const filtered = {};

  for (const section in allNotes) {
    filtered[section] = allNotes[section].filter(note =>
      note.title.toLowerCase().includes(q)
    );
  }

  renderNotes(filtered);
});
</script>
</body>
</html>
