<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–ö–æ–Ω—Å–ø–µ–∫—Ç—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"> 
</head>
<body>

<button id="theme-toggle" class="theme-btn" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
  <span class="sun">‚òÄÔ∏è</span>
  <span class="moon">üåô</span>
</button>

<div class="container"> 

  <header class="note header-card">
    <h1>üìö –ö–æ–Ω—Å–ø–µ–∫—Ç—ã</h1>
  </header>

  <section class="note search-section">
    <input
      id="search"
      placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º..."
      autocomplete="off"
      class="search-input"
    >
    <a href="index.html" class="back-link">
      ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>
  </section>

  <div id="notes"></div>

</div>

<footer>
  <div class="container">
    ¬© <span id="year"></span> –û–≤—Å–∏–µ–Ω–∫–æ –ê–ª–µ–∫—Å–µ–π
  </div>
</footer>

<script>
/* ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ï–ú–û–ô ===== */
const themeBtn = document.getElementById("theme-toggle");
if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark-theme");
}

themeBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark-theme");
    const isDark = document.body.classList.contains("dark-theme");
    localStorage.setItem("theme", isDark ? "dark" : "light");
});

/* ===== –ì–û–î –í –§–£–¢–ï–†–ï ===== */
document.getElementById('year').textContent = new Date().getFullYear();

let allNotes = {};

/* ===== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ===== */
fetch('/notes.json')
  .then(response => {
    if (!response.ok) throw new Error('HTTP ' + response.status);
    return response.json();
  })
  .then(data => {
    allNotes = data;
    renderNotes(data);
  })
  .catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', err);
    document.getElementById('notes').innerHTML = `
      <p class="note error-msg">
        ‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ <b>notes.json</b>.
      </p>
    `;
  });

/* ===== –û–¢–†–ò–°–û–í–ö–ê –ö–ê–†–¢–û–ß–ï–ö ===== */
function renderNotes(data) {
  const container = document.getElementById('notes');
  container.innerHTML = '';
  let hasAny = false;

  for (const section in data) {
    if (!data[section].length) continue;
    hasAny = true;

    const sectionEl = document.createElement('div');
    sectionEl.className = 'section-block';
    sectionEl.innerHTML = <h2>${section}</h2>;

    const grid = document.createElement('div');
    grid.className = 'notes-grid';

    data[section].forEach(note => {
      const card = document.createElement('div');
      card.className = 'note-item-wrapper note';
      card.innerHTML = `
        <a href="${note.file}" class="note-link" target="_blank">
          <span class="icon">üìÑ</span> ${note.title}
        </a>
      `;
      grid.appendChild(card);
    });

    sectionEl.appendChild(grid);
    container.appendChild(sectionEl);
  }

  if (!hasAny) {
    container.innerHTML = <p class="note empty-msg">–ö–æ–Ω—Å–ø–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>;
  }
}

/* ===== –ü–û–ò–°–ö ===== */
document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  const filtered = {};
  for (const section in allNotes) {
    filtered[section] = allNotes[section].filter(note =>
      note.title.toLowerCase().includes(q)
    );
  }
  renderNotes(filtered);
});
</script>

</body>
</html>
